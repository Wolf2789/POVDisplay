#define MAX_STEPS 120
#define MAX_STEPS_HALF (MAX_STEPS/2)
#define STEP12 (MAX_STEPS/12)
#define STEP60 (MAX_STEPS/60)

int clock_hours = 0;
int clock_minutes = 0;
int clock_seconds = 0;
int clock_loop = 0;

byte clock_frame[] {
  B10100100,B11000011,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00001000,B00000000,
  B00000000,B00000000,B00000000,B00000000,B00000011,B10000100,B10000000,B10000011,B10000100,B10000100,B00000011,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,
  B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000001,B00100010,B11100111,B00100000,
  B00000000,B00100011,B01100100,B10100100,B00100011,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,
  B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000011,B10000100,B00000100,B00000100,B00000011,B00000100,B00000100,B10000100,B00000011,B00000000,B00000000,
  B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,B00000000,
  B00000000,B00000000,B00000000,B10100011,B10101100
};

void doClock(int index) {
  // calculate time
  clock_loop++;
  if (clock_loop >= 2500) {
    clock_loop = 0;
    clock_hours = (clock_hours + (clock_minutes / 59)) % 12;
    clock_minutes = (clock_minutes + (clock_seconds / 59)) % 60;
    clock_seconds = (clock_seconds + 1) % 60;
  }

  // show clock face
  Display::SetLeds(0, clock_frame[index]);
  Display::SetLeds(1, B00000000);

  // show clock arms
  if (index == (clock_seconds * STEP60 + MAX_STEPS_HALF) % MAX_STEPS) {
    Display::SetLeds(1, B11111111);
    Display::TurnLeds(0, B11100001, ON);
  } else if (index == (clock_minutes * STEP60 + MAX_STEPS_HALF) % MAX_STEPS) {
    Display::SetLeds(1, B11111111);
    Display::TurnLeds(0, B00100000, ON);
  } else if (index == (clock_hours * STEP12 + MAX_STEPS_HALF) % MAX_STEPS) {
    Display::SetLeds(1, B11111100);
  }

  if (index % (MAX_STEPS / 12) < 2)
    Display::TurnLeds(0, B00001000, ON);
}
